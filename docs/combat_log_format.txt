This file contains my analysis of the combat log format as of
2025-05-15 at SW:ToR release 7.6.1b.

NOTE: When describing the general format of a field, optional
subfields are shown surrounded by square brackets, the typical
covention. Unfortunately, this somewhat conflicts with the fact that
the the line format of the combat, which uses square brackets itself
as a field delimiter, making it ambiguous. Sorry.

Also note that the format uses pipe symbols (|), which is commonly
used as an alteration indicator in most grammars, which also sucks
majorly. 

The file name represents the time that the logfile was created,
roughly corresponding to the first entry in the log, although oddly
not exactly. For example, for file combat_2025-03-21_10_09_48_793647.txt,
the first line's timestamp is 10:10:07.496, almost 20s after the time
in the filename.

The file is a text-only, apparently ASCII, format composed of lines
separated by CR/LF in my situation, since I'm interpreting logs saved
by the Windows client. The line separator may be different depending
on the host system.

All "names," such as a player character's name or an ability name or
an action name etc., are represented as integers and as strings. The
integer is immutable; the string will change based on the translation
being used.

Names are (*almost*) always represented as:

name_string {name_id}

where I believe name_id is a 64-bit unsigned integer. Note that there
is exactly one place where this pattern is broken, namely (ha-ha) for
a player character. That name format is different, sigh.

A line is composed of fields.

The initial 5 fields are surrounded by square brackets and are always
present. Field 6 is an optional field in parens not surrounded by
square brackets for some events that have additional values. Field 7
is an optional field that shows how much threat the source currently
has on the target.

An entire line might look like:

[time] [source] [target] [ability] [action] (value) <threat>

The optional value field is very generic and contains all kinds of
information that generally has a number associated with it (a
"value"), such as damage, energy gained/lost, but even things like the
class of a player character or area information when entered.

Note times and action will always be populated, but source, target,
and ability can be empty, represented as "[]" in the log.

Fields organize subfields in various ways.

The first field is always the time of day to tne nearest millisecond:

10:10:07.496

The second field contains identifying information on the source of the
action. The subfields present:

'[' source '|' '(' location ')' '|' '(' curr_health/total_health ')' ']'

source can have three different formats depending if it's a PC, NPC,
or a PC's companion.

If it's a PC:

'@' pc_name_str '#' pc_name_id

If it's a PC's companion:

'@' pc_name_str '#' pc_name_id '/' comp_name_str '{' comp_name_id '}' ':' comp_instance

If it's an NPC:

npc_name '{' npc_id '}' ':' npc_instance

Note that "instance" applies to sources that can have more than one of
them. For example, an enemy mob (NPC format) might have 4 Manka Cats;
the instance is used to identify which of the 4 cats the line pertains
to.

pc_name_str is text (including spaces)
pc_name_id is a numeric id
comp_name_str is the name of the currently active companion
comp_name_id is the numeric id of the companion
comp_instance is a numeric field for the specific instance of the companion
npc_name_str is text
npc_name_id is the numeric identifier
npc_instance is a numeric field for the specific instance of the NPC
location is described below
curr_health/total_health of the source

coords is broken into 4 fields:

coord_x, coord_y, coord_z, coord_unk3

Axes are as you'd expect cenetered on 0,0,0

x is horizontal with respect to east-west
y is vertical with respect to north-south
z increases rising higher and decreases sinking lower
w is facing in degrees

The third field represents the target of the event. The target field
can be '=' which means, i believe, that the target is the same as the
source. If the target differs from the source, it has the same format
as the source.

Unfortunately, whether or not source and/or target are populated seem
to be somewhat random at this time. I haven't gone through and done a
thorough analysis of why.

The ability field is the ability used in the event. Many events aren't
triggered by abilities, so this can often be empty. This field is just
a name string and it's associated ID.

The action field is the action recorded by the log. This can have
three parts that I call the "noun", "verb," and "detail." Yes, this is
very generic because of the wide variety of actions and how they're
described. Ugh.

The value field is the most varied of them all and is used any time
there's a quantity needed to describe the outcome of the action. For
example, when damage is done, whether that damage is mitigated, if a
charge is gained of lost, resource used, etc. This field is quite
complex and has many optional parts. :/ I think the devs just gave up
at this point.

The threat field is just a number that indicates how much threat the
source has with the target.

log_line := base_log_line value_field threat_field

base_log_line := time_field source_field target_field ability_field action_field

time_field = '[' hours ':' minutes ':' seconds '.' milliseconds ']'

source_field := '[]' | '[' subject '|' loc '|' health ']'

subject := pc_subject | comp_subject | npc_subject

pc_subject = '@' pc_name_str '#' pc_name_id

comp_subject = pc_subject '/' comp ':' comp_instance

comp := name_id_instance

name_id_instance := name_and_id ':' instance

name_and_id = name '{' id '}'

name := string of alpha including space and apostrophe

id := string of numeric, generally a uint64

instance = := string of numeric, generally a uint64

npc_subject := name_id_instance

loc := '(' x ',' y ',' z ',' rot ')'

x := float

y := float

z := float

rot := float

health := '(' curr_health '/' total_health ')'

target_field := '[]' | '[=]' | source_field

ability_field := '[]' | '[' name_and_id ']'

action_field := '[' action_noun action_verb ']' | action_field_with_detail

action_noun := name_and_id

action_verb := name_and_id

action_field_with_detail := '[' action_noun action_verb action_detail ']'

action_detail := name_and_id

value_field := '(' engine_ver ')' | '(' action_value ')' | ''

engine_ver := 'h' 'e' digits

action_value := base_value effective_value value_type mitigation_reason mitigation_effect

base_value := value | crit_value

value := integer

crit_value = integer '*'

effective_value := '~' integer | ''

value_type := name_and_id | ''

mitigation_reason := '-' name_and_id | '-' | ''

mitigation_effect := '(' mitigation_value mitigation_effect_detail ')' | ''

mitigation_value := integer

mitigation_effect_detail := name_and_id

threat_field := '<' threat_value '>' | ''

threat_value := integer


